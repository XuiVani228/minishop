<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .category {
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .category-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2b5876;
        }
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        .product {
            background: #fff;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .product:hover {
            transform: translateY(-5px);
        }
        .product-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .product-price {
            color: #e53935;
            font-weight: bold;
        }
        .product-actions {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        button.remove {
            background: #e53935;
        }
        .cart {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2b5876;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e53935;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .cart-panel {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 15px;
            display: none;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .cart-total {
            font-weight: bold;
            margin-top: 10px;
            text-align: right;
        }
        .checkout-btn {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .tab-container {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background: #eee;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background: #2b5876;
            color: white;
        }
        .content {
            display: none;
        }
        .content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ú–∞–≥–∞–∑–∏–Ω</h1>
        </div>

        <div class="tab-container">
            <div class="tab active" onclick="switchTab('shop')">–ú–∞–≥–∞–∑–∏–Ω</div>
            <div class="tab" onclick="switchTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>

        <div id="shop" class="content active">
            <div id="categories-container"></div>
        </div>

        <div id="profile" class="content">
            <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <div id="profile-info"></div>
            <h3>–í–∞—à–∏ –∑–∞–∫–∞–∑—ã</h3>
            <div id="orders-list"></div>
        </div>

        <div class="cart" onclick="toggleCart()">
            üõí
            <div class="cart-count" id="cart-count">0</div>
        </div>

        <div class="cart-panel" id="cart-panel">
            <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
            <div id="cart-items"></div>
            <div class="cart-total">–ò—Ç–æ–≥–æ: <span id="cart-total">0</span> —Ä—É–±.</div>
            <button class="checkout-btn" onclick="placeOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // Mock –¥–∞–Ω–Ω—ã–µ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑ –±–æ—Ç–∞)
        let products = {
            electronics: [
                {id: 1, name: '–°–º–∞—Ä—Ç—Ñ–æ–Ω', price: 29990, description: '–§–ª–∞–≥–º–∞–Ω 2023'},
                {id: 2, name: '–ù–æ—É—Ç–±—É–∫', price: 74990, description: '–ò–≥—Ä–æ–≤–æ–π –Ω–æ—É—Ç–±—É–∫'}
            ],
            clothes: [
                {id: 3, name: '–§—É—Ç–±–æ–ª–∫–∞', price: 1990, description: '–•–ª–æ–ø–æ–∫ 100%'},
                {id: 4, name: '–î–∂–∏–Ω—Å—ã', price: 4990, description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ'}
            ]
        };
        
        let user = {
            name: tg.initDataUnsafe.user?.first_name || '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å',
            cart: [],
            orders: []
        };

        function renderCategories() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';
            
            for (const [category, items] of Object.entries(products)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                
                const title = document.createElement('div');
                title.className = 'category-title';
                title.textContent = category === 'electronics' ? '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞' : '–û–¥–µ–∂–¥–∞';
                
                const productsDiv = document.createElement('div');
                productsDiv.className = 'products';
                
                items.forEach(product => {
                    const productDiv = document.createElement('div');
                    productDiv.className = 'product';
                    
                    productDiv.innerHTML = `
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-price">${product.price} —Ä—É–±.</div>
                        <div class="product-actions">
                            <button onclick="addToCart(${product.id}, '${category}')">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                    `;
                    
                    productsDiv.appendChild(productDiv);
                });
                
                categoryDiv.appendChild(title);
                categoryDiv.appendChild(productsDiv);
                container.appendChild(categoryDiv);
            }
        }

        function addToCart(productId, category) {
            const product = products[category].find(p => p.id === productId);
            if (product) {
                user.cart.push(product);
                updateCart();
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function removeFromCart(productId) {
            user.cart = user.cart.filter(item => item.id !== productId);
            updateCart();
            tg.HapticFeedback.impactOccurred('light');
        }

        function updateCart() {
            document.getElementById('cart-count').textContent = user.cart.length;
            
            const cartItems = document.getElementById('cart-items');
            const total = user.cart.reduce((sum, item) => sum + item.price, 0);
            
            if (user.cart.length === 0) {
                cartItems.innerHTML = '<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
            } else {
                cartItems.innerHTML = user.cart.map(item => `
                    <div class="cart-item">
                        <div>
                            <div>${item.name}</div>
                            <div>${item.price} —Ä—É–±.</div>
                        </div>
                        <button class="remove" onclick="removeFromCart(${item.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `).join('');
            }
            
            document.getElementById('cart-total').textContent = total;
        }

        function placeOrder() {
            if (user.cart.length === 0) {
                tg.showAlert('–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!');
                return;
            }
            
            tg.showConfirm('–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑?', (confirmed) => {
                if (confirmed) {
                    const orderData = {
                        action: 'place_order',
                        products: user.cart,
                        total: user.cart.reduce((sum, item) => sum + item.price, 0)
                    };
                    
                    tg.sendData(JSON.stringify(orderData));
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–∫–∞–∑–µ
                    tg.showAlert('–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.', () => {
                        user.cart = [];
                        updateCart();
                        toggleCart();
                    });
                }
            });
        }

        function toggleCart() {
            const cartPanel = document.getElementById('cart-panel');
            cartPanel.style.display = cartPanel.style.display === 'block' ? 'none' : 'block';
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        function renderProfile() {
            document.getElementById('profile-info').innerHTML = `
                <p>–ò–º—è: ${user.name}</p>
                <p>–ó–∞–∫–∞–∑–æ–≤: ${user.orders.length}</p>
            `;
            
            document.getElementById('orders-list').innerHTML = user.orders.length > 0
                ? user.orders.map(order => `
                    <div class="order">
                        <p>–ó–∞–∫–∞–∑ #${order.id}</p>
                        <p>–°—Ç–∞—Ç—É—Å: ${order.status}</p>
                    </div>
                `).join('')
                : '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            updateCart();
            renderProfile();
        });
    </script>
</body>
</html>